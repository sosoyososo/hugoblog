---
title: 'UIImage使用UIImageJPEGRepresentation压缩图片不同压缩率的变化'
date: Sat, 27 Dec 2014 09:52:48 +0000
draft: false
tags: ['Objective-C']
---

我们知道图片的jpg格式压缩是有损压缩，但不同压缩率和压缩次数对图片尺寸有什么影响呢？ 读取jpg文件，然后使用UIImageJPEGRepresentation压缩率1.0生成NSData，NSData比文件显示大小大。 循环UIImage->NSData->UIImage会导致数据量增大 但是使用UIImagePNGRepresentation进行循环不会导致数据增大 交叉使用两个方法生成NSData也会导致数据量增大 在压缩率为0.994左右的压缩率上，有一次数据量变化的剧烈变化 在mac上的preview中，当你保存jpg文件的时候，会有一个推荐的压缩率，这个压缩率下保证新保存的文件大小根之前相同。除了这个压缩率之外的其他压缩率下都会导致文件大小的变化 原图片文件大小(byte): 2014-12-27 17:44:44.628 sunflower\[17877:4841584\] 101969 压缩率 次数 数据(byte) 2014-12-27 17:44:44.661 sunflower\[17877:4841584\] 0.000000, 0, 14405 2014-12-27 17:44:44.677 sunflower\[17877:4841584\] 0.000000, 1, 14407 2014-12-27 17:44:44.692 sunflower\[17877:4841584\] 0.000000, 2, 14405 2014-12-27 17:44:44.708 sunflower\[17877:4841584\] 0.000000, 3, 14405 2014-12-27 17:44:44.726 sunflower\[17877:4841584\] 0.000000, 4, 14405 2014-12-27 17:44:44.741 sunflower\[17877:4841584\] 0.000000, 5, 14405 2014-12-27 17:44:44.760 sunflower\[17877:4841584\] 0.000000, 6, 14405 2014-12-27 17:44:44.777 sunflower\[17877:4841584\] 0.000000, 7, 14405 2014-12-27 17:44:44.793 sunflower\[17877:4841584\] 0.000000, 8, 14405 2014-12-27 17:44:44.807 sunflower\[17877:4841584\] 0.000000, 9, 14405 2014-12-27 17:44:44.839 sunflower\[17877:4841584\] 0.100000, 0, 14722 2014-12-27 17:44:44.857 sunflower\[17877:4841584\] 0.100000, 1, 14713 2014-12-27 17:44:44.872 sunflower\[17877:4841584\] 0.100000, 2, 14711 2014-12-27 17:44:44.889 sunflower\[17877:4841584\] 0.100000, 3, 14712 2014-12-27 17:44:44.906 sunflower\[17877:4841584\] 0.100000, 4, 14710 2014-12-27 17:44:44.921 sunflower\[17877:4841584\] 0.100000, 5, 14710 2014-12-27 17:44:44.941 sunflower\[17877:4841584\] 0.100000, 6, 14710 2014-12-27 17:44:44.960 sunflower\[17877:4841584\] 0.100000, 7, 14710 2014-12-27 17:44:44.977 sunflower\[17877:4841584\] 0.100000, 8, 14710 2014-12-27 17:44:44.993 sunflower\[17877:4841584\] 0.100000, 9, 14710 2014-12-27 17:44:45.034 sunflower\[17877:4841584\] 0.200000, 0, 16750 2014-12-27 17:44:45.050 sunflower\[17877:4841584\] 0.200000, 1, 16741 2014-12-27 17:44:45.066 sunflower\[17877:4841584\] 0.200000, 2, 16742 2014-12-27 17:44:45.083 sunflower\[17877:4841584\] 0.200000, 3, 16742 2014-12-27 17:44:45.102 sunflower\[17877:4841584\] 0.200000, 4, 16742 2014-12-27 17:44:45.124 sunflower\[17877:4841584\] 0.200000, 5, 16742 2014-12-27 17:44:45.140 sunflower\[17877:4841584\] 0.200000, 6, 16742 2014-12-27 17:44:45.156 sunflower\[17877:4841584\] 0.200000, 7, 16742 2014-12-27 17:44:45.178 sunflower\[17877:4841584\] 0.200000, 8, 16742 2014-12-27 17:44:45.198 sunflower\[17877:4841584\] 0.200000, 9, 16742 2014-12-27 17:44:45.237 sunflower\[17877:4841584\] 0.300000, 0, 21555 2014-12-27 17:44:45.255 sunflower\[17877:4841584\] 0.300000, 1, 21549 2014-12-27 17:44:45.275 sunflower\[17877:4841584\] 0.300000, 2, 21552 2014-12-27 17:44:45.298 sunflower\[17877:4841584\] 0.300000, 3, 21551 2014-12-27 17:44:45.315 sunflower\[17877:4841584\] 0.300000, 4, 21551 2014-12-27 17:44:45.336 sunflower\[17877:4841584\] 0.300000, 5, 21551 2014-12-27 17:44:45.360 sunflower\[17877:4841584\] 0.300000, 6, 21551 2014-12-27 17:44:45.381 sunflower\[17877:4841584\] 0.300000, 7, 21551 2014-12-27 17:44:45.398 sunflower\[17877:4841584\] 0.300000, 8, 21551 2014-12-27 17:44:45.417 sunflower\[17877:4841584\] 0.300000, 9, 21551 2014-12-27 17:44:45.456 sunflower\[17877:4841584\] 0.400000, 0, 30207 2014-12-27 17:44:45.476 sunflower\[17877:4841584\] 0.400000, 1, 30201 2014-12-27 17:44:45.493 sunflower\[17877:4841584\] 0.400000, 2, 30208 2014-12-27 17:44:45.515 sunflower\[17877:4841584\] 0.400000, 3, 30203 2014-12-27 17:44:45.535 sunflower\[17877:4841584\] 0.400000, 4, 30207 2014-12-27 17:44:45.556 sunflower\[17877:4841584\] 0.400000, 5, 30209 2014-12-27 17:44:45.574 sunflower\[17877:4841584\] 0.400000, 6, 30213 2014-12-27 17:44:45.592 sunflower\[17877:4841584\] 0.400000, 7, 30213 2014-12-27 17:44:45.614 sunflower\[17877:4841584\] 0.400000, 8, 30213 2014-12-27 17:44:45.636 sunflower\[17877:4841584\] 0.400000, 9, 30213 2014-12-27 17:44:45.673 sunflower\[17877:4841584\] 0.500000, 0, 41642 2014-12-27 17:44:45.690 sunflower\[17877:4841584\] 0.500000, 1, 41606 2014-12-27 17:44:45.708 sunflower\[17877:4841584\] 0.500000, 2, 41614 2014-12-27 17:44:45.726 sunflower\[17877:4841584\] 0.500000, 3, 41618 2014-12-27 17:44:45.743 sunflower\[17877:4841584\] 0.500000, 4, 41630 2014-12-27 17:44:45.759 sunflower\[17877:4841584\] 0.500000, 5, 41635 2014-12-27 17:44:45.777 sunflower\[17877:4841584\] 0.500000, 6, 41635 2014-12-27 17:44:45.797 sunflower\[17877:4841584\] 0.500000, 7, 41634 2014-12-27 17:44:45.815 sunflower\[17877:4841584\] 0.500000, 8, 41629 2014-12-27 17:44:45.831 sunflower\[17877:4841584\] 0.500000, 9, 41624 2014-12-27 17:44:45.868 sunflower\[17877:4841584\] 0.600000, 0, 58206 2014-12-27 17:44:45.886 sunflower\[17877:4841584\] 0.600000, 1, 58173 2014-12-27 17:44:45.906 sunflower\[17877:4841584\] 0.600000, 2, 58189 2014-12-27 17:44:45.925 sunflower\[17877:4841584\] 0.600000, 3, 58192 2014-12-27 17:44:45.944 sunflower\[17877:4841584\] 0.600000, 4, 58183 2014-12-27 17:44:45.962 sunflower\[17877:4841584\] 0.600000, 5, 58174 2014-12-27 17:44:45.981 sunflower\[17877:4841584\] 0.600000, 6, 58175 2014-12-27 17:44:45.998 sunflower\[17877:4841584\] 0.600000, 7, 58199 2014-12-27 17:44:46.017 sunflower\[17877:4841584\] 0.600000, 8, 58193 2014-12-27 17:44:46.036 sunflower\[17877:4841584\] 0.600000, 9, 58191 2014-12-27 17:44:46.075 sunflower\[17877:4841584\] 0.700000, 0, 71530 2014-12-27 17:44:46.092 sunflower\[17877:4841584\] 0.700000, 1, 71285 2014-12-27 17:44:46.112 sunflower\[17877:4841584\] 0.700000, 2, 71166 2014-12-27 17:44:46.129 sunflower\[17877:4841584\] 0.700000, 3, 71112 2014-12-27 17:44:46.149 sunflower\[17877:4841584\] 0.700000, 4, 71068 2014-12-27 17:44:46.165 sunflower\[17877:4841584\] 0.700000, 5, 71054 2014-12-27 17:44:46.184 sunflower\[17877:4841584\] 0.700000, 6, 71028 2014-12-27 17:44:46.201 sunflower\[17877:4841584\] 0.700000, 7, 71014 2014-12-27 17:44:46.219 sunflower\[17877:4841584\] 0.700000, 8, 70995 2014-12-27 17:44:46.239 sunflower\[17877:4841584\] 0.700000, 9, 70996 2014-12-27 17:44:46.279 sunflower\[17877:4841584\] 0.800000, 0, 78811 2014-12-27 17:44:46.297 sunflower\[17877:4841584\] 0.800000, 1, 78204 2014-12-27 17:44:46.317 sunflower\[17877:4841584\] 0.800000, 2, 78011 2014-12-27 17:44:46.336 sunflower\[17877:4841584\] 0.800000, 3, 77873 2014-12-27 17:44:46.354 sunflower\[17877:4841584\] 0.800000, 4, 77779 2014-12-27 17:44:46.372 sunflower\[17877:4841584\] 0.800000, 5, 77774 2014-12-27 17:44:46.392 sunflower\[17877:4841584\] 0.800000, 6, 77713 2014-12-27 17:44:46.411 sunflower\[17877:4841584\] 0.800000, 7, 77699 2014-12-27 17:44:46.428 sunflower\[17877:4841584\] 0.800000, 8, 77650 2014-12-27 17:44:46.448 sunflower\[17877:4841584\] 0.800000, 9, 77623 2014-12-27 17:44:46.484 sunflower\[17877:4841584\] 0.900000, 0, 94907 2014-12-27 17:44:46.505 sunflower\[17877:4841584\] 0.900000, 1, 93760 2014-12-27 17:44:46.526 sunflower\[17877:4841584\] 0.900000, 2, 93388 2014-12-27 17:44:46.544 sunflower\[17877:4841584\] 0.900000, 3, 93060 2014-12-27 17:44:46.562 sunflower\[17877:4841584\] 0.900000, 4, 92858 2014-12-27 17:44:46.581 sunflower\[17877:4841584\] 0.900000, 5, 92705 2014-12-27 17:44:46.602 sunflower\[17877:4841584\] 0.900000, 6, 92620 2014-12-27 17:44:46.621 sunflower\[17877:4841584\] 0.900000, 7, 92551 2014-12-27 17:44:46.642 sunflower\[17877:4841584\] 0.900000, 8, 92343 2014-12-27 17:44:46.662 sunflower\[17877:4841584\] 0.900000, 9, 92307 2014-12-27 17:44:46.708 sunflower\[17877:4841584\] 1.000000, 0, 276351 2014-12-27 17:44:46.742 sunflower\[17877:4841584\] 1.000000, 1, 295039 2014-12-27 17:44:46.775 sunflower\[17877:4841584\] 1.000000, 2, 306523 2014-12-27 17:44:46.813 sunflower\[17877:4841584\] 1.000000, 3, 314807 2014-12-27 17:44:46.848 sunflower\[17877:4841584\] 1.000000, 4, 321275 2014-12-27 17:44:46.882 sunflower\[17877:4841584\] 1.000000, 5, 326895 2014-12-27 17:44:46.919 sunflower\[17877:4841584\] 1.000000, 6, 331563 2014-12-27 17:44:46.955 sunflower\[17877:4841584\] 1.000000, 7, 335609 2014-12-27 17:44:46.991 sunflower\[17877:4841584\] 1.000000, 8, 339376 2014-12-27 17:44:47.027 sunflower\[17877:4841584\] 1.000000, 9, 342852 本来想找到一个平衡点压缩率，这个平衡点上压缩率使得获取到的数据大小和文件的大小一致，但发现在0.98947左右，压缩数据大小也会产生一次突变，而文件大小刚好在突变的过程中。可能有什么优化的方法来保证很方便的取到这个值，毕竟apple本身的app是可以做到的，当然也有可能是apple在这个突变的值中间插入了一个magic值，在这个值上直接复制了文件。