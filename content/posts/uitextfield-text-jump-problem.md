---
title: 'UITextField text jump problem(文字跳跃问题)'
date: Thu, 03 Aug 2017 01:51:46 +0000
draft: false
tags: ['iOS']
---

最近在优化一个登录页面的时候碰到一个UI异常问题。知道问题的原因，然后解决掉感觉并没有什么，但想到解决问题的方法，却值得记录。 问题: 一个页面上包含有两个UITextFiled控件，因为某些控件可能被键盘挡住，所以监听键盘事件，在键盘位置变化的时候对控件做响应位置变化。但在输入内容后第一次切换焦点的时候发现会发生文字跳跃现象，这就有点尴尬了。 分析: 我第一时间去dump了UITextFiled在编辑过程中的subview，发现在编辑前后视图树会发生变化，在只有placeholder的时候，内部使用了一个UITextFiledLabel来保存文案，在编辑的时候使用了UIFieldEditor来进行编辑，并且后者是两个显示出来的UITextFiled共享的。编辑结束，焦点切换之后，UITextFiledLabel又用来保存真正的文案，但这个UITextFiledLabel十一个全新的对象(这个是后来分析的时候想到又去确认的，如果当时就想到这点，确认问题的速度会快很多)。 原因: 拍了一下脑袋，感觉应该是新的UITextFiledLabel重新布局时候没有用到动画，只是改变了位置和尺寸，但我在键盘通知里面使用动画来改变整体位置，这个整体是包含UITextField内部UITextFiledLabel的这个小局部的，所以它自然而然的带上了动画，而且是从0位置0尺寸，变到最终的位置和尺寸，也就是界面上出现的动画。 解决: 找到原因，破解就很简单了，最简单的莫过于把自己的布局代码移到后面，避开UITextField内部布局。所以在接受到键盘事件的时候使用了一个dispatch\_after系列函数，将布局后移，果然一切都正常了。