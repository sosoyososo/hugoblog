---
title: '分级动态缓存'
date: Tue, 15 Sep 2020 06:54:12 +0000
draft: false
tags: ['存储', '瞎逼逼']
---

\> 产生这个想法的原因是我认为缓存治理应该是个动态规划的问题，一个合理的规则应该更胜于合理的固定设置。 > 固定设置是指两个方面的固定，数据类型的固定（比如依据api）和存储时间的固定（比如api1的数据缓存5分钟）。 \> 我的思路是对当前环境进行数据量化权重： 1. 不同级别缓存的耗时 a(l) 2. 数据获取耗时 d(key) 3. 数据获取频率 r(key) 4. 数据本身所占空间 s(key) 5. 数据(可能因为更新)从缓存删除的频率dr(key) 6. 每一级缓存的尺寸cs(l) > 数据量越小，获取频率越高的数据，应该存储在更快的介质中，并且存储更长时间。另一方面，缓存删除也应该是一个比较重要的指标。更新越快，存储权重应该越低。

> 1.  数据尺寸s，超过10M，加入权重计算
> 2.  100秒获取100次的数据，100秒内删除了10次，重新获取需要耗时1s，权重为 1/(100-10)。

\> 1. 内存2G，存储速率10，珍贵度10/20=0.5。 2. 数据库100G，存储速率1,珍贵度1/100=0.01。 3. 0.5/0.01 = 50, 内存应该存储前1/51权重的数据，数据库存储剩余的。

> 以上数据计算的所有变量都是平权的，后续的优化可以在权重调整方向进行计算。前面所有的权重，最终会决定分配数据到那个存储，间接确定从存储获取数据的时间，过时时间。我们有数据获取的实例，可以最终模拟出数据获取的总时间，为这个时间求最优解，等价于为多项式求最优解的过程。

在计算过程中，数据获取和删除频率我们需要考虑短时和长时两个权重。 更深层次的优化，应该以场景为分割单元，针对每个场景进行缓存参数训练。