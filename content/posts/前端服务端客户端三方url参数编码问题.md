---
title: '前端服务端客户端三方url参数编码问题'
date: Sat, 27 Feb 2016 05:26:39 +0000
draft: false
tags: ['折腾', '瞎逼逼']
---

**背景:**

开发过程中涉及到客户端前端服务端的三边参数传输，其中在对url进行处理的时候，因为前端跟客户端服务端的url编解码实现差异，造成客户端和服务端进行的url编码，前端处理后不能完全还原(会出现某些特殊符号)

**问题:**

前端和客户端服务端之间进行url交互的时候，url的参数中有特殊符号编码，这时候需要对参数进行编码，但三方编解码不对称问题(一边的编码另一方不能完好解析)。

**现有方案研究对比:**

 _url__编码_ :RFC 1738规定，url可能的内容 0-9a-zA-Z $-\_.+!\*'()，以及一些保留字

 js中最接近的解决方案是encodeURIComponent，但这个方案不会处理~'()!这些特殊字符，java对应的方案会把空格替换成+，iOS(Objective-C/Swift)则是完全按照替换

 对 "/ ?:@％&=~'()!+$,#asd123纯洁"的编码

 _iOS使用stringByAddingPercentEncodingWithAllowedCharacters(NSCharacterSet.alphanumericCharacterSet())__结果是_


```

"%3B%2F%20%3F%3A%40%EF%BC%85%26%3D%7E%27%28%29%21%2B%24%2C%23asd123%E7%BA%AF%E6%B4%81"

```


 _java使用java.net.URLEncoder.encode__结果是_


```

"%3B%2F+%3F%3A%40%EF%BC%85%26%3D%7E%27%28%29%21%2B%24%2C%23asd123%E7%BA%AF%E6%B4%81"

```
 

    JS_使用javascript: encodeURIComponent__结果是_


```

"%3B%2F%20%3F%3A%40%EF%BC%85%26%3D~'()!%2B%24%2C%23asd123%E7%BA%AF%E6%B4%81"

```
 

 _base64_ :a-zA-Z0-9+/进行编码 3B转4\*6bit,6bit(2^6＝64)数值转int作为index对应的编码内容。最后不足的用\=来补充，可能有一个或两个或三个 

**解决思路:**

彻底替换成统一的平台无关的编解码规则

 实现要求:针对url参数需求，

 a.编码后不能有任何除字母数字之外的特殊字符;

 b.编码不应对被编码内容做任何限定;

 c.最好开源;

**解决方案:**

 _建议解决方案__1_.参考base32的解决方案，替换结果里的\=为没有用到的数字即可。RFC 4648 Base32 alphabet中定义的base32转换码为a-z2-7,padding 为＝,只要把＝替换成8即可。 (推荐方案) 

 这个方案中的base32实现，所有平台都有。

 _建议解决方案__2_.参考url的解决方案，三方统一对内容进行utf8后，取内容的每字节的十六进制码，前缀%号 (较麻烦)

 这个方案的需要每个平台自己实现byte到hx string，然后再插入内容